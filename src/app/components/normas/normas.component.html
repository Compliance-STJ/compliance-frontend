<div class="main-content">
  <!-- Header -->
  <div class="header">
    <h1 class="page-title">Gest√£o de Normas de Compliance</h1>
    <p class="page-subtitle">Gerenciamento de normas, leis e regulamentos aplic√°veis ao STJ</p>
  </div>

  <!-- Dialog para Formul√°rio -->
  <app-dialog
    [isOpen]="showNormaDialog"
    [title]="normaEditando ? 'Editar Norma' : 'Nova Norma'"
    width="900px"
    (closed)="fecharDialog()">

    <form (ngSubmit)="salvarNorma()" #normaFormRef="ngForm">
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label" for="nome">Nome *</label>
          <input
            type="text"
            id="nome"
            name="nome"
            class="form-input"
            [(ngModel)]="normaForm.nome"
            required
            maxlength="200"
            placeholder="Ex: Lei Geral de Prote√ß√£o de Dados">
        </div>

        <div class="form-group">
          <label class="form-label" for="numero">N√∫mero *</label>
          <input
            type="text"
            id="numero"
            name="numero"
            class="form-input"
            [(ngModel)]="normaForm.numero"
            required
            maxlength="50"
            placeholder="Ex: Lei n¬∫ 13.709/2018">
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label" for="situacaoId">Situa√ß√£o *</label>
          <select
            id="situacaoId"
            name="situacaoId"
            class="form-select"
            [(ngModel)]="normaForm.situacaoId"
            required>
            <option [value]="null" disabled>Selecione uma situa√ß√£o</option>
            <option *ngFor="let situacao of situacoes" [value]="situacao.id">
              {{ situacao.descricao }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label" for="origemId">Origem</label>
          <select
            id="origemId"
            name="origemId"
            class="form-select"
            [(ngModel)]="normaForm.origemId">
            <option [value]="null">Nenhuma</option>
            <option *ngFor="let origem of origens" [value]="origem.id">
              {{ origem.nome }}
            </option>
          </select>
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label" for="dataNorma">Data da Norma *</label>
          <input
            type="date"
            id="dataNorma"
            name="dataNorma"
            class="form-input"
            [(ngModel)]="normaForm.dataNorma"
            required>
        </div>

        <div class="form-group">
          <label class="form-label" for="dataPublicacao">Data de Publica√ß√£o</label>
          <input
            type="date"
            id="dataPublicacao"
            name="dataPublicacao"
            class="form-input"
            [(ngModel)]="normaForm.dataPublicacao">
        </div>

        <div class="form-group">
          <label class="form-label" for="dataVigencia">Data de Vig√™ncia</label>
          <input
            type="date"
            id="dataVigencia"
            name="dataVigencia"
            class="form-input"
            [(ngModel)]="normaForm.dataVigencia">
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label" for="categoria">Categoria</label>
          <input
            type="text"
            id="categoria"
            name="categoria"
            class="form-input"
            [(ngModel)]="normaForm.categoria"
            maxlength="100"
            placeholder="Ex: Prote√ß√£o de Dados, Seguran√ßa da Informa√ß√£o">
        </div>

        <div class="form-group">
          <label class="form-label" for="orgaoEmissor">√ìrg√£o Emissor</label>
          <input
            type="text"
            id="orgaoEmissor"
            name="orgaoEmissor"
            class="form-input"
            [(ngModel)]="normaForm.orgaoEmissor"
            maxlength="200"
            placeholder="Ex: Congresso Nacional">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" for="descricao">Descri√ß√£o</label>
        <textarea
          id="descricao"
          name="descricao"
          class="form-textarea"
          [(ngModel)]="normaForm.descricao"
          rows="3"
          placeholder="Descreva brevemente o conte√∫do da norma...">
        </textarea>
      </div>

      <div class="form-group">
        <label class="form-label" for="link">Link/URL</label>
        <input
          type="url"
          id="link"
          name="link"
          class="form-input"
          [(ngModel)]="normaForm.link"
          maxlength="500"
          placeholder="https://...">
      </div>

      <div class="form-group">
        <label class="form-label" for="observacoes">Observa√ß√µes</label>
        <textarea
          id="observacoes"
          name="observacoes"
          class="form-textarea"
          [(ngModel)]="normaForm.observacoes"
          rows="2"
          placeholder="Observa√ß√µes adicionais...">
        </textarea>
      </div>

      <div class="form-actions">
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!normaFormRef.form.valid || loading">
          <i class="icon">üíæ</i>
          {{loading ? 'Salvando...' : 'Salvar'}}
        </button>
        <button
          type="button"
          class="btn btn-secondary"
          (click)="fecharDialog()">
          <i class="icon">‚úó</i>
          Cancelar
        </button>
      </div>
    </form>
  </app-dialog>

  <!-- Lista de Normas -->
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Normas Cadastradas ({{ totalElements }})</h3>
    </div>

    <!-- A√ß√µes e Filtros -->
    <div class="actions-panel">
      <div class="actions-left">
        <button
          class="btn btn-primary"
          (click)="adicionarNovaNorma()">
          <i class="icon">+</i>
          Nova Norma
        </button>

        <div class="filter-buttons">
          <button
            class="btn filter-btn"
            [class.active]="filtroSituacao === null"
            (click)="filtrarPorSituacao(null)">
            Todas
          </button>
          <button
            *ngFor="let situacao of situacoes"
            class="btn filter-btn"
            [class.active]="filtroSituacao === situacao.id"
            (click)="filtrarPorSituacao(situacao.id!)">
            {{ situacao.descricao }}
          </button>
        </div>
      </div>

      <div class="search-bar">
        <input
          type="text"
          class="form-input"
          placeholder="Buscar por nome..."
          [(ngModel)]="termoBusca"
          (keyup.enter)="buscar()">
        <button class="btn btn-primary" (click)="buscar()">
          <i class="icon">üîç</i>
          Buscar
        </button>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Carregando normas...</p>
    </div>

    <!-- Estado vazio -->
    <div *ngIf="!loading && normasData.length === 0" class="empty-state">
      <div class="empty-icon">üìö</div>
      <h3>Nenhuma norma encontrada</h3>
      <p>Clique em "Nova Norma" para come√ßar</p>
      <button class="btn btn-primary" (click)="adicionarNovaNorma()">
        <i class="icon">+</i>
        Criar primeira norma
      </button>
    </div>

    <!-- Tabela de normas -->
    <div *ngIf="!loading && normasData.length > 0" class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>N√∫mero</th>
            <th>Situa√ß√£o</th>
            <th>Categoria</th>
            <th>Data da Norma</th>
            <th>Origem</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let norma of normasData">
            <td>
              <strong>{{ norma.nome }}</strong>
              <div class="descricao-mini" *ngIf="norma.descricao">{{ norma.descricao }}</div>
            </td>
            <td>{{ norma.numero }}</td>
            <td>
              <span
                class="status-badge"
                [ngClass]="getSituacaoClass(getSituacaoDescricao(norma))">
                {{ getSituacaoDescricao(norma) }}
              </span>
            </td>
            <td>{{ norma.categoria || '-' }}</td>
            <td>{{ formatarData(norma.dataNorma) }}</td>
            <td>{{ norma.origemNome || '-' }}</td>
            <td>
              <div class="action-buttons">
                <button
                  class="action-btn btn-view"
                  (click)="visualizarNorma(norma)"
                  title="Visualizar">
                  <i class="icon">üëÅÔ∏è</i>
                </button>
                <button
                  class="action-btn btn-edit"
                  (click)="editarNorma(norma)"
                  title="Editar">
                  <i class="icon">‚úèÔ∏è</i>
                </button>
                <button
                  class="action-btn btn-delete"
                  (click)="excluirNorma(norma.id!)"
                  title="Remover">
                  <i class="icon">üóëÔ∏è</i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagina√ß√£o -->
    <div *ngIf="!loading && normasData.length > 0" class="pagination">
      <button
        class="btn btn-secondary"
        [disabled]="currentPage === 0"
        (click)="paginaAnterior()">
        ‚Üê Anterior
      </button>

      <span class="pagination-info">
        P√°gina {{ currentPage + 1 }} de {{ totalPages }} ({{ totalElements }} normas)
      </span>

      <button
        class="btn btn-secondary"
        [disabled]="currentPage >= totalPages - 1"
        (click)="proximaPagina()">
        Pr√≥xima ‚Üí
      </button>
    </div>
  </div>
</div>
