<div class="situacao-obrigacao-container">
  <!-- Header -->
  <div class="header">
    <h1 class="page-title">Gest√£o de Situa√ß√µes de Obriga√ß√£o</h1>
    <p class="page-subtitle">Gerencie as situa√ß√µes que as obriga√ß√µes podem assumir no sistema</p>
  </div>

  <!-- Mensagens -->
  <div class="messages" *ngIf="mensagemSucesso || mensagemErro">
    <div class="alert alert-success" *ngIf="mensagemSucesso">
      <i class="icon">‚úì</i>
      {{ mensagemSucesso }}
    </div>
    <div class="alert alert-error" *ngIf="mensagemErro">
      <i class="icon">‚úó</i>
      {{ mensagemErro }}
    </div>
  </div>

  <!-- A√ß√µes principais -->
  <div class="actions">
    <button 
      class="btn btn-primary" 
      (click)="novaSituacao()"
      [disabled]="carregando">
      <i class="icon">+</i>
      Nova Situa√ß√£o
    </button>
    <button 
      class="btn btn-secondary" 
      (click)="carregarSituacoes()"
      [disabled]="carregando">
      <i class="icon">üîÑ</i>
      Atualizar
    </button>
    <button 
      class="btn" 
      [class.btn-primary]="mostrarApenasAtivas"
      [class.btn-secondary]="!mostrarApenasAtivas"
      (click)="alternarFiltro()"
      [disabled]="carregando">
      <i class="icon">üîç</i>
      {{ mostrarApenasAtivas ? 'Mostrar Todas' : 'Apenas Ativas' }}
    </button>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="carregando">
    <div class="spinner"></div>
    <p>Carregando...</p>
  </div>

  <!-- Formul√°rio -->
  <div class="form-container" *ngIf="mostrarFormulario">
    <div class="form-header">
      <h2>{{ editando ? 'Editar' : 'Nova' }} Situa√ß√£o de Obriga√ß√£o</h2>
    </div>
    
    <form (ngSubmit)="salvarSituacao()" #formularioRef="ngForm">
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label" for="codigo">C√≥digo *</label>
          <input 
            type="text" 
            id="codigo"
            name="codigo"
            class="form-input" 
            [(ngModel)]="formulario.codigo"
            required
            maxlength="50"
            placeholder="Ex: PENDENTE, APROVADA, REJEITADA">
        </div>

        <div class="form-group">
          <label class="form-label" for="descricao">Descri√ß√£o *</label>
          <input 
            type="text" 
            id="descricao"
            name="descricao"
            class="form-input" 
            [(ngModel)]="formulario.descricao"
            required
            maxlength="200"
            placeholder="Descri√ß√£o da situa√ß√£o da obriga√ß√£o">
        </div>

        <div class="form-group">
          <label class="form-label">
            <input 
              type="checkbox" 
              [(ngModel)]="formulario.ativo"
              name="ativo"
              class="form-checkbox"> 
            Situa√ß√£o ativa
          </label>
        </div>
      </div>

      <div class="form-actions">
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="carregando || !formularioRef.form.valid">
          <i class="icon">üíæ</i>
          {{ editando ? 'Atualizar' : 'Salvar' }}
        </button>
        <button 
          type="button" 
          class="btn btn-secondary"
          (click)="cancelarFormulario()">
          <i class="icon">‚úó</i>
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <!-- Tabela de situa√ß√µes -->
  <div class="table-container" *ngIf="!carregando">
    <div class="table-header">
      <h3>
        Situa√ß√µes Cadastradas ({{ situacoes.length }})
        <span class="filter-info" *ngIf="mostrarApenasAtivas"> - Apenas Ativas</span>
      </h3>
    </div>

    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>C√≥digo</th>
            <th>Descri√ß√£o</th>
            <th>Status</th>
            <th>Data Cria√ß√£o</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let situacao of situacoes; trackBy: trackBySituacao" 
              [class.row-selected]="situacao === situacaoSelecionada">
            <td>
              <span class="codigo-badge codigo-obrigacao">{{ situacao.codigo }}</span>
            </td>
            <td>{{ situacao.descricao }}</td>
            <td>
              <span 
                class="status-badge" 
                [class.status-active]="situacao.ativo"
                [class.status-inactive]="!situacao.ativo"
                (click)="alternarStatus(situacao)"
                title="Clique para alterar status">
                {{ situacao.ativo ? 'Ativo' : 'Inativo' }}
              </span>
            </td>
            <td>
              <span *ngIf="situacao.createdAt">
                {{ situacao.createdAt | date:'dd/MM/yyyy' }}
              </span>
              <span *ngIf="!situacao.createdAt">-</span>
            </td>
            <td>
              <div class="action-buttons">
                <button 
                  class="action-btn btn-edit"
                  (click)="editarSituacao(situacao)"
                  title="Editar situa√ß√£o">
                  <i class="icon">‚úèÔ∏è</i>
                </button>
                <button 
                  class="action-btn btn-delete"
                  (click)="excluirSituacao(situacao)"
                  title="Excluir situa√ß√£o">
                  <i class="icon">üóëÔ∏è</i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Mensagem quando n√£o h√° dados -->
      <div class="empty-state" *ngIf="situacoes.length === 0 && !carregando">
        <div class="empty-icon">üìã</div>
        <h3>Nenhuma situa√ß√£o {{ mostrarApenasAtivas ? 'ativa' : '' }} cadastrada</h3>
        <p>Clique em "Nova Situa√ß√£o" para come√ßar</p>
      </div>
    </div>
  </div>
</div>