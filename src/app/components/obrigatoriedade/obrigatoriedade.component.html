<div class="obrigatoriedade-container">
  <!-- Header -->
  <div class="header">
    <h1 class="page-title">Gest√£o de Obrigatoriedades</h1>
    <p class="page-subtitle">Gerencie os tipos de obrigatoriedade do sistema de compliance</p>
  </div>


  <!-- Estat√≠sticas (opcional) -->
  <!-- <div class="stats-row" *ngIf="estatisticas">
    <div class="stat-card">
      <div class="stat-number">{{ estatisticas.total }}</div>
      <div class="stat-label">Total</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ estatisticas.ativas }}</div>
      <div class="stat-label">Ativas</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ estatisticas.vigentes }}</div>
      <div class="stat-label">Vigentes</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ estatisticas.inativas }}</div>
      <div class="stat-label">Inativas</div>
    </div>
  </div> -->

  <!-- Loading -->
  <div class="loading" *ngIf="carregando">
    <div class="spinner"></div>
    <p>Carregando...</p>
  </div>

  <!-- Dialog para Formul√°rio -->
  <app-dialog
    [isOpen]="mostrarFormulario"
    [title]="obrigatoriedadeEditando ? 'Editar Obrigatoriedade' : 'Nova Obrigatoriedade'"
    width="700px"
    (closed)="onDialogClosed()">

    <form (ngSubmit)="salvarObrigatoriedade()" #obrigatoriedadeForm="ngForm">
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label" for="nome">Nome *</label>
          <input
            type="text"
            id="nome"
            [(ngModel)]="novaObrigatoriedade.nome"
            name="nome"
            required
            maxlength="100"
            placeholder="Ex: Obrigat√≥rio, Recomendado, Opcional..."
            class="form-input">
        </div>

        <div class="form-group">
          <label class="form-label" for="ordem">Ordem</label>
          <input
            type="number"
            id="ordem"
            [(ngModel)]="novaObrigatoriedade.ordem"
            name="ordem"
            min="1"
            placeholder="Ordem de exibi√ß√£o"
            class="form-input">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" for="descricao">Descri√ß√£o</label>
        <textarea
          id="descricao"
          [(ngModel)]="novaObrigatoriedade.descricao"
          name="descricao"
          maxlength="1000"
          rows="3"
          placeholder="Descri√ß√£o detalhada da obrigatoriedade..."
          class="form-textarea"></textarea>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label" for="dataInicio">Data de In√≠cio</label>
          <input
            type="date"
            id="dataInicio"
            [(ngModel)]="novaObrigatoriedade.dataInicio"
            name="dataInicio"
            class="form-input">
        </div>

        <div class="form-group">
          <label class="form-label" for="dataFim">Data de Fim</label>
          <input
            type="date"
            id="dataFim"
            [(ngModel)]="novaObrigatoriedade.dataFim"
            name="dataFim"
            class="form-input">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">
          <input
            type="checkbox"
            [(ngModel)]="novaObrigatoriedade.ativo"
            name="ativo"
            class="form-checkbox">
          Obrigatoriedade ativa
        </label>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="carregando || !obrigatoriedadeForm.form.valid">
          <i class="icon">üíæ</i>
          {{carregando ? 'Salvando...' : (obrigatoriedadeEditando ? 'Atualizar' : 'Salvar')}}
        </button>
        <button type="button" class="btn btn-secondary" (click)="cancelarEdicao()">
          <i class="icon">‚úó</i>
          Cancelar
        </button>
      </div>
    </form>
  </app-dialog>

  <!-- Lista de Obrigatoriedades -->
  <div class="table-container" *ngIf="!carregando">
    <div class="table-header">
      <h3>Obrigatoriedades Cadastradas ({{ obrigatoriedades.length }})</h3>
    </div>
    
    <!-- A√ß√µes principais -->
    <div class="actions">
      <button class="btn btn-primary" (click)="novaObrigatoriedadeFormulario()">
        <i class="icon">+</i>
        Nova Obrigatoriedade
      </button>
      
      <!-- <button class="btn btn-secondary" (click)="carregarObrigatoriedades()">
        <i class="icon">üîÑ</i>
        Atualizar
      </button> -->
      
      <!-- <div class="filter-buttons">
        <button 
          class="btn filter-btn"
          [class.active]="filtroAtivo === ''"
          (click)="filtroAtivo = ''; aplicarFiltros()">
          Todas
        </button>
        <button 
          class="btn filter-btn"
          [class.active]="filtroAtivo === 'true'"
          (click)="filtroAtivo = 'true'; aplicarFiltros()">
          Ativas
        </button>
      </div> -->
      
      <!-- <div class="search-bar">
        <input 
          type="text" 
          [(ngModel)]="termoBusca" 
          (keyup.enter)="aplicarFiltros()"
          placeholder="Buscar por nome ou descri√ß√£o..."
          class="form-input">
        <button class="btn btn-primary" (click)="aplicarFiltros()">
          <i class="icon">üîç</i>
          Buscar
        </button>
      </div> -->
    </div>
    
    <div class="table-responsive">
      <table class="data-table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Descri√ß√£o</th>
            <th>Status</th>
            <th>Vig√™ncia</th>
            <th>Ordem</th>
            <th>Cria√ß√£o</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let obrigatoriedade of obrigatoriedadesFiltradas" 
              (click)="selecionarObrigatoriedade(obrigatoriedade)"
              [class.selected]="obrigatoriedadeSelecionada?.id === obrigatoriedade.id">
            <td>
              <div class="cell-content">
                <strong>{{ obrigatoriedade.nome }}</strong>
              </div>
            </td>
            <td>
              <div class="cell-content">
                {{ obrigatoriedade.descricao || '-' }}
              </div>
            </td>
            <td>
              <div class="status-badges">
                <span 
                  class="badge" 
                  [class.active]="obrigatoriedade.ativo" 
                  [class.inactive]="!obrigatoriedade.ativo"
                  (click)="alternarStatus(obrigatoriedade); $event.stopPropagation()"
                  title="Clique para alterar status"
                  style="cursor: pointer;">
                  {{ obrigatoriedade.ativo ? 'Ativo' : 'Inativo' }}
                </span>
                <!-- <span class="badge vigente" *ngIf="isVigente(obrigatoriedade)">
                  Vigente
                </span> -->
              </div>
            </td>
            <td>
              <div class="cell-content">
                <div *ngIf="obrigatoriedade.dataInicio || obrigatoriedade.dataFim; else semVigencia">
                  {{ formatarData(obrigatoriedade.dataInicio) }} at√© {{ formatarData(obrigatoriedade.dataFim) }}
                </div>
                <ng-template #semVigencia>-</ng-template>
              </div>
            </td>
            <td>
              <div class="cell-content">
                {{ obrigatoriedade.ordem || '-' }}
              </div>
            </td>
            <td>
              <div class="cell-content">
                {{ formatarData(obrigatoriedade.dataCriacao) }}
              </div>
            </td>
            <td>
              <div class="action-buttons">
                <button 
                  class="btn btn-sm btn-primary" 
                  (click)="editarObrigatoriedade(obrigatoriedade); $event.stopPropagation()"
                  title="Editar">
                  <i class="icon">‚úèÔ∏è</i>
                </button>
                <button 
                  class="btn btn-sm btn-danger" 
                  (click)="excluirObrigatoriedade(obrigatoriedade); $event.stopPropagation()"
                  title="Excluir">
                  <i class="icon">üóëÔ∏è</i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      
      <!-- Mensagem quando n√£o h√° dados -->
      <div class="no-data" *ngIf="obrigatoriedadesFiltradas.length === 0 && !carregando">
        <div class="no-data-icon">üìã</div>
        <h3>Nenhuma obrigatoriedade encontrada</h3>
        <p *ngIf="termoBusca || filtroAtivo || filtroVigencia">
          Tente ajustar os filtros ou limpar a busca.
        </p>
        <p *ngIf="!termoBusca && !filtroAtivo && !filtroVigencia">
          Clique em "Nova Obrigatoriedade" para come√ßar.
        </p>
        <button class="btn btn-primary" (click)="novaObrigatoriedadeFormulario()" *ngIf="!termoBusca && !filtroAtivo && !filtroVigencia">
          <i class="icon">+</i>
          Criar Primeira Obrigatoriedade
        </button>
      </div>
    </div>
  </div>

  <!-- Detalhes da Obrigatoriedade Selecionada -->
  <div class="details-section" *ngIf="obrigatoriedadeSelecionada && !mostrarFormulario">
    <div class="details-header">
      <h3>Detalhes da Obrigatoriedade</h3>
      <button class="btn btn-secondary" (click)="obrigatoriedadeSelecionada = null">
        <i class="icon">‚úñÔ∏è</i>
        Fechar
      </button>
    </div>
    
    <div class="details-content">
      <div class="detail-item">
        <label>Nome:</label>
        <span>{{ obrigatoriedadeSelecionada.nome }}</span>
      </div>
      
      <div class="detail-item" *ngIf="obrigatoriedadeSelecionada.descricao">
        <label>Descri√ß√£o:</label>
        <span>{{ obrigatoriedadeSelecionada.descricao }}</span>
      </div>
      
      <div class="detail-item">
        <label>Status:</label>
        <span class="badge" [class.active]="obrigatoriedadeSelecionada.ativo" [class.inactive]="!obrigatoriedadeSelecionada.ativo">
          {{ obrigatoriedadeSelecionada.ativo ? 'Ativo' : 'Inativo' }}
        </span>
      </div>
      
      <div class="detail-item" *ngIf="obrigatoriedadeSelecionada.ordem">
        <label>Ordem:</label>
        <span>{{ obrigatoriedadeSelecionada.ordem }}</span>
      </div>
      
      <div class="detail-item" *ngIf="obrigatoriedadeSelecionada.dataInicio">
        <label>Data de In√≠cio:</label>
        <span>{{ formatarData(obrigatoriedadeSelecionada.dataInicio) }}</span>
      </div>
      
      <div class="detail-item" *ngIf="obrigatoriedadeSelecionada.dataFim">
        <label>Data de Fim:</label>
        <span>{{ formatarData(obrigatoriedadeSelecionada.dataFim) }}</span>
      </div>
      
      <div class="detail-item">
        <label>Data de Cria√ß√£o:</label>
        <span>{{ formatarData(obrigatoriedadeSelecionada.dataCriacao) }}</span>
      </div>
      
      <div class="detail-item" *ngIf="obrigatoriedadeSelecionada.dataAtualizacao !== obrigatoriedadeSelecionada.dataCriacao">
        <label>√öltima Atualiza√ß√£o:</label>
        <span>{{ formatarData(obrigatoriedadeSelecionada.dataAtualizacao) }}</span>
      </div>
    </div>
  </div>
</div>